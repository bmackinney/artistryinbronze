{{ if .Get "id" }}

  {{ if .Get "src" }}
  <!-- if the shortcode has both an id and a src, ignore any figures.yml document and render only the values given in the shortcode -->

    <figure class="q-figure{{ with .Get "class" }} q-{{ . }}{{ end }}" id="{{ with .Get "id" }}{{ . }}{{ end }}">
      <div class="q-figure__wrapper">
        <img  src="/figures/{{ .Get "src" }}" alt="{{ with .Get "alt" }}{{ . }}{{ end }}" />
        {{ with .Get "label" }}
        <span class="q-figure-label">{{ . }}</span>
        {{ end }}
      </div>
      {{ with .Get "caption" }}
      <figcaption>{{ .  | markdownify }}</figcaption>
      {{ end }}
    </figure>

  {{ else }}
  <!-- if the shortcode has an id, but no src, look for figures.yml document and render the figure from matching values found there -->

    {{ $x := .Get "id" | string }}
    {{ range where .Site.Data.figures.figure_list "id" "eq" $x }}
    <figure class="q-figure{{ with $.Get "class" }} q-{{ . }}{{ end }}" id="{{ .id }}">
      <div class="q-figure__wrapper">
        {{ if eq .media_type "inline-svg" }}
          {{ .src | safeHTML }}
        {{ else }}
          <img  src="/figures/{{ .src }}" alt="{{ if $.Get "alt" }}{{ $.Get "alt" }}{{ else }}{{ .alt }}{{ end }}" />
        {{ end }}
        {{ if $.Get "label" }}

        {{ if eq ($.Get "label") "true" }}
          {{ if .label }}
          <span class="q-figure-label">{{ .label | markdownify }}</span>
          {{ else }}
          <span class="q-figure-label">{{ $.Site.Params.imageLabelContentBefore }}{{ .id }}</span>
          {{ end }}
        {{ else }}
            <span class="q-figure-label">{{ $.Get "label" | markdownify }}</span>
        {{ end }}
        {{ end }}

      </div>
      {{ if $.Get "caption" }}
        <figcaption>{{ $.Get "caption" }}</figcaption>
      {{ else }}
      {{ if .caption }}
        <figcaption><span class="q-figure-label">{{ $.Site.Params.imageLabelContentBefore }}{{ .id }}{{ $.Site.Params.imageLabelContentAfter }}</span>{{ .caption | markdownify }}</figcaption>
      {{ end }}
      {{ end }}
    </figure>
    {{ end }}

  {{ end }}

{{ else }}

  {{ if .Get "src" }}
  <!-- if the shortcode has a src, but no id, render the figure from the values given in the shortcode -->

    <figure class="q-figure{{ with .Get "class" }} q-{{ . }}{{ end }}">
      <div class="q-figure__wrapper">
        {{ if eq .media_type "inline-svg" }}
          {{ .src | safeHTML }}
        {{ else }}
          <img  src="/figures/{{ .src }}" alt="{{ if $.Get "alt" }}{{ $.Get "alt" }}{{ else }}{{ .alt }}{{ end }}" />
        {{ end }}
        {{ with .Get "label" }}
        <span class="q-figure-label">{{ . }}</span>
        {{ end }}
      </div>
      {{ with .Get "caption" }}
      <figcaption>{{ .  | markdownify }}</figcaption>
      {{ end }}
    </figure>

  {{ else }}
  <!-- if the shortcode has no id and no src, don't render anything -->

  {{ end }}

{{ end }}
